<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>আমার নিউজ সাইট</title>
    <link rel="stylesheet" href="css/style.css">
    
    <!-- এরর ডিটেকশন -->
    <script>
        window.onerror = function(msg, url, line) {
            console.error('Error:', msg, 'at line', line);
            return false;
        };
    </script>
</head>
<body>
    <header>
        <div class="container">
            <h1 id="site-title">আমার নিউজ সাইট</h1>
            <nav>
                <a href="#" onclick="showHome()">হোম</a>
                <a href="#" onclick="showAbout()">আমাদের সম্পর্কে</a>
                <a href="./admin/">অ্যাডমিন</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="filter-bar">
            <input type="text" id="search-input" placeholder="খুঁজুন..." onkeyup="handleSearch()">
            <select id="category-filter" onchange="applyFilters()">
                <option value="">সব ক্যাটাগরি</option>
            </select>
        </div>

        <div id="posts-container">
            <div class="loading">লোড হচ্ছে...</div>
        </div>
    </main>

    <footer>
        <p>&copy; ২০২৪ আমার নিউজ সাইট</p>
    </footer>

    <!-- সব JS ফাইল একসাথে -->
    <script>
        // ==========================================
        // i18n.js - ভাষা ম্যানেজার
        // ==========================================
        class I18nManager {
            constructor() {
                this.currentLang = localStorage.getItem('language') || 'bn';
            }
            
            getPostContent(post) {
                return post.translations?.[this.currentLang] || post;
            }
        }
        
        const i18n = new I18nManager();

        // ==========================================
        // filters.js - ফিল্টার ম্যানেজার
        // ==========================================
        class FilterManager {
            constructor() {
                this.filters = { search: '', category: '' };
            }
            
            init(data) {
                this.allPosts = data.posts || [];
                const catSelect = document.getElementById('category-filter');
                const categories = [
                    { id: 'tech', name: 'প্রযুক্তি' },
                    { id: 'politics', name: 'রাজনীতি' },
                    { id: 'sports', name: 'খেলাধুলা' }
                ];
                
                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.id;
                    option.textContent = cat.name;
                    catSelect.appendChild(option);
                });
            }
            
            setSearch(query) {
                this.filters.search = query.toLowerCase();
                this.applyFilters();
            }
            
            setCategory(cat) {
                this.filters.category = cat;
                this.applyFilters();
            }
            
            applyFilters() {
                let filtered = this.allPosts.filter(post => {
                    if (post.published === false) return false;
                    
                    if (this.filters.search) {
                        const title = (post.translations?.bn?.title || post.title).toLowerCase();
                        if (!title.includes(this.filters.search)) return false;
                    }
                    
                    if (this.filters.category && post.category !== this.filters.category) {
                        return false;
                    }
                    
                    return true;
                });
                
                renderResults(filtered);
            }
        }
        
        const filter = new FilterManager();

        function handleSearch() {
            const query = document.getElementById('search-input').value;
            filter.setSearch(query);
        }

        function applyFilters() {
            const cat = document.getElementById('category-filter').value;
            filter.setCategory(cat);
        }

        function renderResults(posts) {
            const container = document.getElementById('posts-container');
            
            if (posts.length === 0) {
                container.innerHTML = '<div class="no-results">কোনো পোস্ট পাওয়া যায়নি</div>';
                return;
            }
            
            container.innerHTML = posts.map(post => {
                const content = i18n.getPostContent(post);
                return `
                    <article class="post-card" data-id="${post.id}">
                        <h2 class="post-title">${content.title || post.title}</h2>
                        <div class="post-meta">
                            <span class="post-category">${post.category || 'অজানা'}</span>
                            <span>${post.date || ''}</span>
                        </div>
                        <div class="post-content">${content.content || ''}</div>
                    </article>
                `;
            }).join('');
        }

        // ==========================================
        // main.js - মূল কন্টেন্ট ম্যানেজার
        // ==========================================
        class ContentManager {
            constructor() {
                this.data = null;
                this.basePath = 'https://sabbir128.github.io/world-news-pro/';
            }
            
            async loadContent() {
                try {
                    const url = this.basePath + 'data/content.json?t=' + Date.now();
                    console.log('Fetching:', url);
                    
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        throw new Error('HTTP ' + response.status);
                    }
                    
                    this.data = await response.json();
                    console.log('Loaded posts:', this.data.posts?.length);
                    return this.data;
                    
                } catch (error) {
                    console.error('Error:', error);
                    document.getElementById('posts-container').innerHTML = 
                        '<div style="text-align:center;padding:2rem;color:red;">ত্রুটি: ' + error.message + '</div>';
                    return { posts: [] };
                }
            }
            
            async renderPosts(containerId) {
                const data = await this.loadContent();
                
                // ফিল্টার ইনিশিয়ালাইজ
                filter.init(data);
                
                // সব পোস্ট দেখান
                const published = data.posts?.filter(p => p.published !== false) || [];
                renderResults(published);
                
                // সাইট টাইটেল আপডেট
                if (data.settings?.siteTitle) {
                    document.getElementById('site-title').textContent = data.settings.siteTitle;
                    document.title = data.settings.siteTitle;
                }
            }
        }
        
        const contentManager = new ContentManager();

        // অটো স্টার্ট
        document.addEventListener('DOMContentLoaded', () => {
            contentManager.renderPosts('posts-container');
        });

        function showHome() {
            location.reload();
        }

        function showAbout() {
            alert('আমাদের সম্পর্কে পেজ শীঘ্রই আসছে');
        }
    </script>
</body>
    </html>
    
